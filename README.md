# WP - Скрипт соотнесения вариаций товаров WooCommerce с цветами и изображениями

Скрипт для автоматизации процесса управления вариациями товаров, их цветами и изображениями в WooCommerce.

## Функциональность

Этот скрипт выполняет следующие действия:

1. Считывает информацию о соответствии артикулов и цветов из текстового файла
2. Находит вариации товаров в WooCommerce по артикулу
3. Устанавливает правильное значение атрибута color для вариаций (создает его, если нужно)
4. Извлекает номер цвета из информации о цвете
5. Ищет соответствующие изображения в директории на основе названия модели и номера цвета
6. Присваивает найденные изображения к вариациям товаров

## Требования

- WordPress с установленным и активированным WooCommerce
- Доступ к файловой системе сервера
- Плагин WPCode или другой способ выполнения PHP-кода в WordPress

## Настройка

### Шаг 1: Подготовка файлов

1. Загрузите файл соответствий (`соответствия.txt`) на сервер в папку `/wp-content/uploads/correspondence/`
2. Распакуйте ZIP-файлы с изображениями в папку `/wp-content/uploads/product_images/`
3. Убедитесь, что структура папок сохраняется - каждая модель должна быть в отдельной папке (например, "Soft Tweed")

### Шаг 2: Настройка скрипта

В файле `script-for-wpcode.php` настройте следующие параметры:

```php
$correspondence_file = ABSPATH . 'wp-content/uploads/correspondence/соответствия.txt';
$images_directory = ABSPATH . 'wp-content/uploads/product_images/';
```

### Шаг 3: Запуск скрипта

#### Метод 1: Через WPCode

1. Установите и активируйте плагин WPCode
2. Создайте новый сниппет, выберите тип PHP
3. Вставьте содержимое файла `script-for-wpcode.php`
4. Раскомментируйте строку `// run_color_matcher();` в конце файла
5. Сохраните и запустите сниппет

#### Метод 2: Как отдельный скрипт

1. Загрузите файл `script-for-wpcode.php` на сервер
2. Откройте файл в браузере или выполните через командную строку PHP

## Формат данных

### Файл соответствий (TXT)

Файл содержит строки с соответствием артикула и цвета. Каждая строка имеет формат:

```
{артикул} {цвет}
```

Например:
```
nOyBG8vJiyYxgwnsoqoAb3 01 / off white uni
```

### Структура директорий с изображениями

Изображения должны быть организованы в директориях, где название директории содержит название модели продукта. Файлы изображений должны содержать номер цвета (например, "01.jpg", "01-2.jpg").

Пример структуры:
```
product_images/
  ├── Soft Tweed/
  │   ├── 01.jpg
  │   ├── 01-2.jpg
  │   ├── 02.jpg
  │   └── ...
  ├── Sky/
  │   ├── 01.jpg
  │   ├── 02.jpg
  │   └── ...
  └── ...
```

## Логирование

Скрипт создает подробный лог своей работы в файле `color-matcher-log.txt` в корневой директории WordPress. Это поможет отследить успешность выполнения и найти возможные проблемы.

## Особенности работы скрипта

1. **Извлечение названия модели:** Скрипт ищет в названии товара паттерн "Drops X", где X - название модели. Если такой паттерн не найден, предполагается, что первое слово - это бренд, а остальное - название модели.

2. **Извлечение номера цвета:** Скрипт ищет в строке с информацией о цвете формат "XX / название цвета", где XX - номер цвета. Если такой формат не найден, скрипт пытается найти просто числовой код в начале строки.

3. **Поиск изображений:** Для каждой вариации скрипт ищет соответствующие изображения в папке с названием модели. Если найдено несколько изображений с одним номером цвета (например, "01.jpg", "01-2.jpg"), скрипт выбирает наименьшее по размеру.

---

## Возможные проблемы и решения

1. **Не находятся изображения:**
   - Проверьте правильность путей к папкам
   - Убедитесь, что имена папок и файлов соответствуют ожидаемому формату
   - Проверьте права доступа к файлам и папкам

2. **Не обновляются атрибуты цвета:**
   - Проверьте, что атрибут "color" создан в WooCommerce
   - Убедитесь, что у скрипта есть права на создание терминов таксономии

3. **Скрипт работает слишком долго:**
   - Попробуйте обрабатывать товары порциями, добавив ограничение на количество обрабатываемых товаров за один запуск

## Техническая поддержка

Для вопросов и улучшений используйте раздел Issues данного репозитория.
