# Инструкции по установке и настройке

Это пошаговое руководство поможет вам правильно настроить и запустить скрипт для соотнесения вариаций товаров в WooCommerce с их цветами и изображениями.

## Шаг 1: Подготовка файловой структуры

1. **Создайте следующие папки на вашем сервере:**
   ```
   wp-content/uploads/correspondence/
   wp-content/uploads/product_images/
   ```

2. **Загрузите файл соответствий:**
   - Поместите файл `соответствия.txt` в папку `wp-content/uploads/correspondence/`

3. **Загрузите изображения:**
   - Распакуйте архивы с изображениями в папку `wp-content/uploads/product_images/`
   - Убедитесь, что каждая модель находится в своей папке (например, "Soft Tweed", "Sky" и т.д.)

## Шаг 2: Установка и настройка WPCode

1. **Установите плагин WPCode:**
   - Перейдите в панель администратора WordPress -> Плагины -> Добавить новый
   - Найдите "WPCode" и нажмите "Установить", затем "Активировать"

2. **Создайте новый сниппет:**
   - Перейдите в WPCode -> Сниппеты -> Добавить новый
   - Дайте сниппету название, например "Соотнесение цветов и изображений вариаций"
   - Выберите тип сниппета "PHP"
   - В содержимое вставьте код из файла `script-for-wpcode.php`

3. **Настройте пути в сниппете:**
   - Убедитесь, что пути к файлу соответствий и папке с изображениями указаны правильно:
   ```php
   $correspondence_file = ABSPATH . 'wp-content/uploads/correspondence/соответствия.txt';
   $images_directory = ABSPATH . 'wp-content/uploads/product_images/';
   ```

4. **Раскомментируйте строку запуска:**
   - Раскомментируйте строку `// run_color_matcher();` в конце файла, убрав символы `//`

## Шаг 3: Проверка атрибутов в WooCommerce

1. **Проверьте наличие атрибута "цвет":**
   - Перейдите в WooCommerce -> Настройки -> Продукты -> Атрибуты
   - Убедитесь, что атрибут "color" (цвет) существует
   - Если его нет, создайте новый атрибут с названием "color"

2. **Проверьте настройки атрибута:**
   - Атрибут должен быть глобальным (используется для вариаций)
   - Должен быть включен в архивы (Enable Archives)

## Шаг 4: Тестовый запуск скрипта

1. **Запустите скрипт в тестовом режиме:**
   - В WPCode сохраните сниппет, но не активируйте его
   - Нажмите кнопку "Запустить только один раз" для тестового запуска

2. **Проверьте журнал выполнения:**
   - После запуска проверьте созданный файл журнала `color-matcher-log.txt` в корневой директории WordPress
   - Убедитесь, что нет серьезных ошибок

3. **Проверьте результаты:**
   - Откройте несколько товаров, у которых должны были обновиться вариации
   - Проверьте, что атрибут "color" установлен правильно
   - Проверьте, что изображения правильно прикреплены к вариациям

## Шаг 5: Полный запуск и мониторинг

1. **Запустите скрипт для всех товаров:**
   - Если тестовый запуск прошел успешно, активируйте сниппет
   - Выберите в настройках сниппета "Запускать вручную"

2. **Запустите скрипт:**
   - Нажмите кнопку "Запустить" для полного выполнения скрипта
   - Дождитесь завершения выполнения (это может занять время, если у вас много товаров)

3. **Мониторинг прогресса:**
   - Периодически проверяйте файл журнала `color-matcher-log.txt` для отслеживания прогресса
   - Проверяйте обновленные товары и вариации в магазине

## Решение возможных проблем

### Проблема: Скрипт не находит изображения

**Решение:**
1. Проверьте корректность пути к папке с изображениями
2. Убедитесь, что названия папок соответствуют названиям моделей в товарах
3. Проверьте, что номера цветов в файле соответствий совпадают с именами файлов изображений
4. Измените функцию `extract_model_name()` в скрипте, если требуется другой алгоритм извлечения названия модели

### Проблема: Атрибуты цвета не обновляются

**Решение:**
1. Проверьте, что атрибут "color" создан в WooCommerce и настроен правильно
2. Убедитесь, что у учетной записи WordPress есть права на создание терминов таксономии
3. Проверьте, что строки в файле соответствий имеют корректный формат

### Проблема: Скрипт выполняется слишком долго или зависает

**Решение:**
1. Измените функцию `update_product_variations_with_colors()`, добавив ограничение на количество обрабатываемых товаров за раз
2. Реализуйте пагинацию для обработки товаров порциями
3. Запускайте скрипт в нерабочие часы, когда нагрузка на сервер минимальна

## Дополнительные рекомендации

1. **Резервное копирование:**
   - Перед запуском скрипта создайте резервную копию базы данных и файлов
   - Это позволит легко восстановить систему в случае проблем

2. **Регулярные обновления:**
   - Если вы регулярно добавляете новые товары, настройте сниппет для периодического запуска
   - В WPCode можно установить расписание выполнения (ежедневно, еженедельно и т.д.)

3. **Модификация скрипта:**
   - Если у вас особая структура данных, не стесняйтесь модифицировать скрипт
   - Адаптируйте функции `extract_model_name()` и `extract_color_number()` под ваши потребности

4. **Обработка ошибок:**
   - Расширьте систему логирования для более детального отслеживания ошибок
   - Добавьте уведомления по email в случае критических ошибок

## Контакты для поддержки

Если у вас возникли вопросы или проблемы с настройкой и использованием скрипта, вы можете:

1. Создать Issue в репозитории GitHub
2. Связаться с разработчиком через систему сообщений GitHub
